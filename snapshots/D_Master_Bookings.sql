{% snapshot D_Master_Bookings %}

{{
        config(
          target_schema='dbt_Intralinks',
          strategy='check',
          unique_key='unique_key',
          invalidate_hard_deletes=True,
          check_cols=['unique_key',
                        'deal_id',
                        'opportunity_name',
                        'type_of_booking',
                        'type',
                        'geo',
                        'line_of_business',
                        'market_offerings',
                        'closed_date',
                        'closed_month',
                        'closed_qtr',
                        'closed_year',
                        'account_id',
                        'account_name',
                        'industry',
                        'record_type',
                        'parent_record_type',
                        'stage',
                        'parent_stage',
                        'reason_code',
                        'deal_contract',
                        'term',
                        'contract_term',
                        'opportunity_term',
                        'country',
                        'area',
                        'create_date',
                        'created_month',
                        'created_qtr',
                        'created_year',
                        'contract_type',
                        'opportunity_owner',
                        'opportunity_manager',
                        'parent_account_name',
                        'end_client_id',
                        'end_client_name',
                        'end_client_country',
                        'ilpartner',
                        'bill_to_city',
                        'bill_to_state',
                        'bill_to_zipcode',
                        'source',
                        'territory_name',
                        'territory_owner',
                        'opportunity_id',
                        'use_type',
                        'opportunity_age',
                        'route_to_market',
                        'account_domain',
                        'account_type',
                        'deal_count',
                        'currency_code',
                        'acv_native',
                        'tcv_native',
                        'acv_constant',
                        'tcv_constant',
                        'acv_actual',
                        'tcv_actual',
                        'revenue_start_date',
                        'revenue_end_date',
                        'contract_name',
                        'auto_renew',
                        'lead_source',
                        'campaign_id',
                        'next_step',
                        'secondary_use_type',
                        'advisor_name',
                        'initial_period_start_date',
                        'initial_period_end_date',
                        'invoice_number',
                        'approved_quote_term',
                        'approved_renewal_term',
                        'opportunity_status',
                        'contract_id',
                        'partner_role',
                        'quote_one_time_charge',
                        'quote_recurr_charge',
                        'quote_recurr_mrr',
                        'renewal_baseline_amount',
                        'renewal_baseline_amt_constant',
                        'renewal_baseline_mrr',
                        'renewal_baseline_term',
                        'mrr_delta',
                        'mrr_delta_constant',
                        'expected_renewal_start_dt',
                        'curr_contract_recurr_amt',
                        'curr_contract_term_mrr',
                        'opportunity_type',
                        'migrated_from_wst',
                        'end_client_geo',
                        'opportunity_creation_metric',
                        'opportunity_created_by',
                        'end_client_parent_account_name',
                        'renewal_baseline_amt_acv_constant',
                        'win_rate_total',
                        'end_client_bill_to_city',
                        'end_client_bill_to_state',
                        'current_opportunity_flag',
                        'sic_code',
                        'sic_description',
                        'naics_code',
                        'naics_description',
                        'arr_end_date',
                        'legacy_flag',
                        'deal_contract_id'],
        )
    }}


 select unique_key,
deal_id,
opportunity_name,
type_of_booking,
"type",
geo,
line_of_business,
market_offerings,
closed_date,
closed_month,
closed_qtr,
closed_year,
account_id,
account_name,
industry,
record_type,
parent_record_type,
stage,
parent_stage,
reason_code,
deal_contract,
term,
contract_term,
opportunity_term,
country,
area,
create_date,
created_month,
created_qtr,
created_year,
contract_type,
opportunity_owner,
opportunity_manager,
parent_account_name,
end_client_id,
end_client_name,
end_client_country,
ilpartner,
bill_to_city,
bill_to_state,
bill_to_zipcode,
"source",
territory_name,
territory_owner,
opportunity_id,
use_type,
opportunity_age,
route_to_market,
account_domain,
account_type,
deal_count,
currency_code,
acv_native,
tcv_native,
acv_constant,
tcv_constant,
acv_actual,
tcv_actual,
revenue_start_date,
revenue_end_date,
contract_name,
auto_renew,
lead_source,
campaign_id,
next_step,
secondary_use_type,
advisor_name,
initial_period_start_date,
initial_period_end_date,
invoice_number,
approved_quote_term,
approved_renewal_term,
opportunity_status,
contract_id,
partner_role,
quote_one_time_charge,
quote_recurr_charge,
quote_recurr_mrr,
renewal_baseline_amount,
renewal_baseline_amt_constant,
renewal_baseline_mrr,
renewal_baseline_term,
mrr_delta,
mrr_delta_constant,
expected_renewal_start_dt,
curr_contract_recurr_amt,
curr_contract_term_mrr,
opportunity_type,
migrated_from_wst,
end_client_geo,
opportunity_creation_metric,
--cast('${new_or_last_work_unit_id}' as bigint)  as WORK_UNIT_ID,
opportunity_created_by,
END_CLIENT_PARENT_ACCOUNT_NAME,
renewal_baseline_amt_acv_constant,
win_rate_total, 
end_client_bill_to_city, 
end_client_bill_to_state, 
current_opportunity_flag,
sic_code,
sic_description,
naics_code,
naics_description,
arr_end_date,
legacy_flag,
deal_contract_id,
from obie_reports.vw_mbt_union_view

{% endsnapshot %}